<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>æç®€å£°ç–— Â· æ²‰æµ¸äº¤äº’</title>

<style>
:root {
  --bg-color: #2D1B1B;
  --accent-color: #FF8A65;
  --text-main: rgba(255,255,255,.65);
  --text-sub: rgba(255,255,255,.55);
  --card-bg: rgba(255,255,255,.08);
  --transition: .6s;
}

* { margin:0; padding:0; box-sizing:border-box; user-select:none; -webkit-tap-highlight-color:transparent; }
html, body { height:100%; overflow:hidden; font-family:-apple-system,system-ui,sans-serif; background:#000; }

.app {
  height:100%;
  background: var(--bg-color);
  transition: background var(--transition);
  display: flex;
  flex-direction: column;
  position: relative;
  z-index: 0;
}

/* --- æ–°å¢ï¼šé¡¶éƒ¨å€’è®¡æ—¶åŒº --- */
.countdown-container {
  position: absolute;
  top: 145px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  opacity: 0;
  transition: opacity 0.5s ease;
  z-index: 10;
  pointer-events: none;
}
.countdown-container.show { opacity: 1; }
.countdown-time {
  font-size: 52px;
  font-weight: 800;
  color: var(--text-main);
  font-variant-numeric: tabular-nums;
  letter-spacing: -1px;
}
.countdown-label {
  font-size: 11px;
  color: var(--accent-color); /* éšä¸»é¢˜å˜è‰² */
  letter-spacing: 3px;
  margin-top: -2px;
  transition: color var(--transition);
}

/* é¡¶éƒ¨æç¤º */
.top-hint { text-align:center; font-size:10px; color:var(--text-sub); letter-spacing:3px; padding-top:16px; }

/* æ¨èåŒº */
.recommend-section { margin-top:18px;  }
.recommend-title { font-size:13px; color:var(--text-sub); margin-bottom:10px;padding:0 20px; }
.horizational::-webkit-scrollbar{display:none}
.horizational {
    overflow: auto;
    height: 72px;
    display: flex;
    align-items: flex-end;
    padding: 0 20px;
}
.horizontal-scroll { display:flex; gap:12px;scrollbar-width:none; }
.horizontal-scroll::-webkit-scrollbar { display:none; }
.recommend-card {
  flex:0 0 145px; background:var(--card-bg); border-radius: 60% 60% 20% 20% / 20% 60% 20% 60%;
  padding:10px; display:flex; align-items:flex-end; height: 56px; gap:8px;
  transition: all 0.3s ease-in-out;
}
.recommend-card.active {
  transform: scale(1.05);
  transition: all 0.3s ease-in-out;
  border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%;
}

.card-icon { width:45px; height:56px;  flex-shrink: 0; border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; display:flex; align-items:center; justify-content:center; font-size: 20px; background: linear-gradient(to top, transparent, #f0f8ff 30%, #f0f8ff);}
.card-text { font-size:14px; color:var(--text-main); line-height: 56px; }

/* ä¿¡æ¯åŒº */
.info-panel { margin-top:60px; padding:0 30px; pointer-events:none; }
.current-name { font-size:48px; font-weight:800; color:var(--text-sub); }
.current-desc { margin-top:6px; font-size:13px; color:var(--text-sub); max-width:240px; line-height:1.4; }

/* å£°éŸ³åˆ—è¡¨åˆ—è¡¨ */
.list-viewport {
  display:flex; justify-content:flex-end; padding-right:20px;
  mask-image:linear-gradient(to bottom,transparent,black 20%,black 80%,transparent);
  height: 520px; margin-top: 20px;
}
.sound-list { width:85%; pointer-events:auto;transition: transform .5s cubic-bezier(.4,0,.2,1);
    will-change: transform; }
.sound-item {
  background:var(--card-bg); border-radius:12px; padding:12px 15px;
  display:flex; align-items:center; gap:12px; margin-bottom:14px;
  opacity:.25; transform:scale(.92); transition:.45s;position: relative;
}
.sound-item.active {
  opacity:1; transform:scale(1.05); border:1px solid var(--accent-color);
  background:rgba(255,255,255,.12); color: #fff;
  right: 20px;
  background-size: 100% 100%;
  background-repeat: no-repeat;
  background-position: center;
  background-size: cover;
}
.sound-item.preactive {
  transform:scale(1); 
  right: 12px;
}
.sound-item.nextactive {
  opacity:0.8; transform:scale(1); 
  right: 12px;
}

.vinyl { width:38px; height:38px; background:#111; border-radius:50%; display:flex; justify-content:center; align-items:center; }
.vinyl::after { content:''; width:8px; height:8px; background:var(--accent-color); border-radius:50%; transition: background 0.6s; }

.wave-view { flex:1; height:18px; display:flex; gap:3px; align-items: center; }
.wave-view span { flex:1; height:30%; background:rgba(255,255,255,.2); transition:.3s; }
.active .wave-view span { background:var(--accent-color); }

/* --- åº•éƒ¨æ§åˆ¶ & å®šæ—¶å™¨ --- */
.bottom-controls { position:absolute; left:0; right:0; bottom:40px; display:flex; justify-content: center; align-items:center; }

.play-btn {
  width:68px; height:68px; background:var(--accent-color); border-radius:50%;
  display: flex; justify-content: center; align-items: center;
  box-shadow: 0 10px 25px rgba(0,0,0,0.3); transition: transform 0.2s, background 0.6s;
}
.play-btn:active { transform: scale(0.9); }

/* å³ä¾§å®šæ—¶å™¨å®¹å™¨ */
.setting-bar { position: absolute; left: 25px; bottom: 0; display: flex; flex-direction: column; align-items: center; gap: 12px; width: 80px; }
.setting-bar-left {
    display:flex;
  flex-direction: column;
  align-items:center;
  gap:20px;
  font-size:14px;
  color:var(--text-sub);
  position: absolute;
  right: 25px;
  bottom: 0px;
}
.timer-container { position: relative; width: 30px; height: 180px; display: flex; justify-content: center; touch-action: none; }

.timer-track { width: 6px; height: 100%; background: rgba(255,255,255,0.1); border-radius: 10px; position: relative; overflow: hidden; }

.timer-progress {
  position: absolute; bottom: 0; width: 100%; height: 0%;
  background: linear-gradient(to top, rgba(255,255,255,0.1), var(--accent-color));
  transition: height 0.3s cubic-bezier(0.25, 0.1, 0.25, 1);
}

.timer-handle {
  position: absolute; left: 50%; bottom: 0%; width: 20px; height: 20px;
  background: #fff; border: 4px solid #111; border-radius: 50%;
  transform: translate(-50%, 50%); z-index: 10;
  box-shadow: 0 2px 8px rgba(0,0,0,0.5);
  transition: bottom 0.3s cubic-bezier(0.25, 0.1, 0.25, 1);
}

.timer-tooltip {
  position: absolute; right: -68px; bottom: 0%;
  background: var(--accent-color); color: #fff;
  padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: bold;
  transform: translateY(50%); white-space: nowrap;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  transition: bottom 0.3s cubic-bezier(0.25, 0.1, 0.25, 1), background 0.6s;
}
.timer-tooltip::after {
  content: ""; position: absolute; left: -5px; top: 50%; transform: translateY(-50%);
  border-top: 5px solid transparent; border-bottom: 5px solid transparent;
  border-right: 6px solid var(--accent-color); transition: border-left-color 0.6s;
}

.fade-text {
  transition:
    opacity .45s cubic-bezier(.4,0,.2,1),
    transform .45s cubic-bezier(.4,0,.2,1);
}

.fade-text.out {
  opacity: 0;
  transform: translateX(-152px);
}
.fade-text.in {
  opacity: 1;
  transform: translateY(0);
}
.fade-text.enter {
  opacity: 0;
  transform: translateX(152px);
}
#curName {
  transition-duration: .35s;
}

#curDesc {
  transition-duration: .35s;
  transition-delay: .08s;
}
.timer-badge { font-size: 10px; color: var(--text-sub); letter-spacing: 1px; margin-top: 12px; }

.momentBackText {
    position: absolute;
    height: 100vh;
    width: 200px;
    right: -60px;
    text-align: center;
    font-size: 120px;
    font-weight: 600;
    user-select: none;
    pointer-events: none;
    color: var(--text-sub);
    letter-spacing: 1px;
    margin-bottom: 12px;
    writing-mode: vertical-rl;
    text-orientation: upright;
    display: flex;
    justify-content: center;
    -webkit-mask-image: linear-gradient(to left, rgba(0,0,0,1) 20%, rgba(0,0,0,0) 100%);
    -webkit-mask-repeat: no-repeat;
    -webkit-mask-size: 100% 100%;
    mask-image: linear-gradient(to left, rgba(0,0,0,1) 10%, rgba(0,0,0,0) 100%);
    mask-repeat: no-repeat;
    mask-size: 100% 100%;
}
.momentBackText span {
    display: block;
}
.blur-bg-container {
    position: absolute;
    top: -10%;
    left: -10%;
    width: 120%;
    height: 120%;
    z-index: -2;
    overflow: hidden;
    transition: opacity 1.5s ease;
    opacity: 0;
}

#blurBg {
    width: 100%;
    height: 100%;
    object-fit: cover;
    -webkit-mask-image: radial-gradient(circle at center, rgba(0, 0, 0, 0.6) 0%, rgba(0, 0, 0, 0.3) 20%, rgba(0, 0, 0, 0.2) 32%, rgba(0, 0, 0, 0) 100%);
    -webkit-mask-repeat: no-repeat;
    -webkit-mask-size: 100% 100%;

    mask-image: radial-gradient(circle at center, rgba(0, 0, 0, 0.6) 0%, rgba(0, 0, 0, 0.3) 20%, rgba(0, 0, 0, 0.2) 32%, rgba(0, 0, 0, 0) 100%);
    mask-repeat: no-repeat;
    mask-size: 100% 100%;
}

/* å›¾æ ‡ */
.play-icon { width: 0; height: 0; border-style: solid; border-width: 12px 0 12px 20px; border-color: transparent transparent transparent #fff; margin-left: 5px; }
.pause-icon { display: none; width: 18px; height: 24px; border-left: 6px solid #fff; border-right: 6px solid #fff; }
.playing .play-icon { display: none; }
.playing .pause-icon { display: block; }
</style>
</head>

<body>
<div class="app" id="app">

  <div class="top-hint">ä¸Šä¸‹æ»‘åŠ¨åˆ‡æ¢å£°éŸ³</div>

  <div id="countDownDisplay" class="countdown-container">
    <span class="countdown-time">00:00</span>
    <span class="countdown-label">REMAINING TIME</span>
  </div>

  <div class="recommend-section">
    <div class="recommend-title">ä¸ºä½ æ¨è</div>
    <div class="horizational">
        <div class="horizontal-scroll">
          <div class="recommend-card"><div class="card-icon">ğŸ”¥</div><div class="card-text">ä¸‡ç‰©è‡ªç„¶å£°</div></div>
          <div class="recommend-card"><div class="card-icon">ğŸŒ§</div><div class="card-text">çº¯å‡€é¢‘ç‡éŸ³</div></div>
          <div class="recommend-card"><div class="card-icon">ğŸ“–</div><div class="card-text">ç©ºçµå†¥æƒ³æ›²</div></div>
          <div class="recommend-card"><div class="card-icon">ğŸŒŒ</div><div class="card-text">æŸ”å’Œå™¨ä¹éŸ³</div></div>
          <div class="recommend-card"><div class="card-icon">ğŸ§©</div><div class="card-text">æ„å¢ƒè§£å‹åœº</div></div>
        </div>
    </div>
  </div>

  <div class="info-panel">
    <p style="color:var(--accent-color); transition: color 0.6s;">â— æ­£åœ¨æ’­æ”¾</p>
    <div class="current-name fade-text" id="curName">è¥ç«</div>
    <div class="current-desc fade-text" id="curDesc"></div>
  </div>

  <div class="list-viewport" id="listViewport">
    <div class="sound-list" id="soundList"></div>
  </div>

  <div class="bottom-controls">

    <div class="setting-bar-left">
       <div class="timer-badge">ç”œèœ.é£é“ƒç§‘æŠ€â„¢</div>
    </div>

    <div class="play-btn" id="playBtn">
      <div class="play-icon"></div>
      <div class="pause-icon"></div>
    </div>

    <div class="setting-bar">
      <div class="timer-container" id="timerContainer">
        <div class="timer-tooltip" id="timerTooltip">å…³é—­</div>
        <div class="timer-track">
          <div class="timer-progress" id="timerProgress"></div>
        </div>
        <div class="timer-handle" id="timerHandle"></div>
      </div>
      <div class="timer-badge" id="timerBadge">å®šæ—¶å…³é—­</div>
    </div>
  </div>
  <div class="momentBackText" id="momentBackText"></div>
  <div class="blur-bg-container" id="blurContainer">
      <img id="blurBg" src="" alt="">
  </div>
</div>
<script>
    /******************************
     * æ•°æ®ä¸éŸ³æ•ˆèµ„æº
     ******************************/
    let sounds = [
      { name: 'è¥ç«', desc: 'æ¸©æš–çš„æœ¨æŸ´ç«ç„°å£°ï¼Œè½»è½»åŠˆå•ªå“ï¼Œå¸¦æ¥å†¬å¤œæ¸©é¦¨æ„Ÿ', bg: '#2B1610', accent: '#FF7043', key: 'wind', imgUrl: 'images/Gemini_Generated_Image_d5q93xd5q93xd5q9.png' },
    ]

    const allList = [
        { name: 'è¥ç«', desc: 'æ¸©æš–çš„æœ¨æŸ´ç«ç„°å£°ï¼Œè½»è½»åŠˆå•ªå“ï¼Œå¸¦æ¥å†¬å¤œæ¸©é¦¨æ„Ÿ', bg: '#2B1610', accent: '#FF7043', key: 'wind', imgUrl: 'images/Gemini_Generated_Image_d5q93xd5q93xd5q9.png' },
    ] 

    const recommendList = [
      { name: 'ä¸‡ç‰©è‡ªç„¶å£°', keyvalue: [
        { name: 'é›¨æ—', desc: 'æ¹¿æ¶¦å®é™çš„æ£®æ—é›¨å£°ï¼Œç»†é›¨è½å¶é—´ï¼Œæ´—æ¶¤å¿ƒçµçƒ¦èºæ„Ÿ', bg: '#0F2A1D', accent: '#6FCF97', key: 'birds', imgUrl: 'images/Gemini_Generated_Image_g9www3g9www3g9ww.png' },
        { name: 'æ·±æµ·', desc: 'ä½é¢‘å®‰æŠšæ·±åº¦ç¡çœ ï¼Œæµ·æ°´æ¶ŒåŠ¨å£°ï¼Œä»¿ä½›æ½œå…¥å®é™æµ·åº•', bg: '#050B1E', accent: '#1BCEDB', key: 'chocolate', imgUrl: 'images/Gemini_Generated_Image_slrmudslrmudslrm.png' },
        { name: 'æå…‰', desc: 'åŒ—æ¬§å¤œç©ºå†¥æƒ³ï¼Œæ˜Ÿå…‰é—ªçƒä¸‹ï¼Œå¿ƒçµæ¼‚æµ®äºæå…‰ä¹‹ä¸­', bg: '#0E1028', accent: '#9BFFEC', key: 'ear', imgUrl: 'images/Gemini_Generated_Image_d5q93xd5q93xd5q9.png' },
      ] },
      { name: 'çº¯å‡€é¢‘ç‡éŸ³', keyvalue: [
        { name: 'é£é“ƒ', desc: 'æ¸…è„†æ‚¦è€³çš„é£é“ƒå£°ï¼Œå¾®é£æ‹‚è¿‡çª—å‰ï¼Œå¸¦æ¥å¤æ—¥æ¸…å‡‰æ„Ÿ', bg: '#101820', accent: '#FFD166', key: 'paper', imgUrl: 'images/Gemini_Generated_Image_25jhe25jhe25jhe2.png'  },
        { name: 'é¸Ÿé¸£', desc: 'æ¸…æ™¨è‡ªç„¶é¸Ÿå«å£°ï¼Œé˜³å…‰æ´’è½æ—é—´ï¼Œå”¤é†’è½»æŸ”çš„æ—©æ™¨', bg: '#1A2E3B', accent: '#7ED957', key: 'birds', imgUrl: 'images/Gemini_Generated_Image_g9www3g9www3g9ww.png'  },
        { name: 'æºªæµ', desc: 'æ½ºæ½ºæºªæ°´å£°ï¼Œå±±é—´æµæ°´å¥”æµï¼Œæ²äººå¿ƒè„¾é™å¿ƒå®‰ç¥', bg: '#081A2F', accent: '#7ABEFF', key: 'paper', imgUrl: 'images/Gemini_Generated_Image_slrmudslrmudslrm.png'  },
      ] },
      { name: 'ç©ºçµå†¥æƒ³æ›²', keyvalue: [
        { name: 'è™«é¸£', desc: 'å¤æ—¥æ˜†è™«é¸£å«ï¼Œå¤œæ™šé™è°§ä¸­ï¼Œè™«å£°ä¼´éšå…¥çœ æ·±å¤„', bg: '#070B18', accent: '#FF8C42', key: 'birds', imgUrl: 'images/Gemini_Generated_Image_g9www3g9www3g9ww.png'  },
        { name: 'æµ·æµª', desc: 'å®é™æµ·æ»©æ³¢æµªå£°ï¼Œæµ·æ°´è½»æ‹ç¤çŸ³ï¼Œå¿ƒéšæµªèŠ±å¹³é™', bg: '#081226', accent: '#4FC3F7', key: 'chocolate', imgUrl: 'images/Gemini_Generated_Image_d5q93xd5q93xd5q9.png'  },
        { name: 'é’Ÿæ‘†', desc: 'æ²‰ç¨³æœºæ¢°é’Ÿæ‘†å£°ï¼Œè§„å¾‹æ‘†åŠ¨ä¸­ï¼Œå¸¦æ¥æ—¶é—´çš„å®‰å¿ƒæ„Ÿ', bg: '#0E0E0E', accent: '#A78BFA', key: 'ear', imgUrl: 'images/Gemini_Generated_Image_slrmudslrmudslrm.png'  },
      ] },
      { name: 'æŸ”å’Œå™¨ä¹éŸ³', keyvalue: [
        { name: 'æ²™æ¼', desc: 'å¤è€æ²™æ¼æ¼æ²™å£°ï¼Œç»†æ²™ç¼“è½ï¼Œè±¡å¾å…‰é˜´æµé€å®é™', bg: '#1A140D', accent: '#E6C79C', key: 'wind', imgUrl: 'images/Gemini_Generated_Image_g9www3g9www3g9ww.png'  },
        { name: 'çƒ›å…‰', desc: 'æ¸©é¦¨æ‘‡æ›³çƒ›å…‰å£°ï¼Œç«ç„°è½»æ™ƒï¼Œå¤œæ™šçš„æŸ”å…‰ä¸æš–æ„æ„Ÿ', bg: '#140A06', accent: '#FFB703', key: 'chocolate', imgUrl: 'images/Gemini_Generated_Image_d5q93xd5q93xd5q9.png' },
        { name: 'é›¨æ»´', desc: 'æ»´ç­”é›¨æ»´å£°ï¼Œçª—å¤–é›¨å£°ç‚¹ç‚¹ï¼Œé™è°§æ—¶å…‰ç¼“ç¼“æµæ·Œ', bg: '#0A1322', accent: '#8ECDF4', key: 'paper', imgUrl: 'images/Gemini_Generated_Image_slrmudslrmudslrm.png'  },
      ] },
      { name: 'æ„å¢ƒè§£å‹åœº', keyvalue: [
        { name: 'å¿ƒè·³', desc: 'æ²‰ç¨³å¿ƒè·³å£°ï¼Œä»¿ä½›èº«ä½“èŠ‚å¥ï¼Œå¸¦æ¥å®‰å…¨ä¸å¹³é™æ„Ÿ', bg: '#1B0D12', accent: '#E63946', key: 'ear', imgUrl: 'images/Gemini_Generated_Image_g9www3g9www3g9ww.png'  },
        { name: 'é’Ÿè¡¨', desc: 'ä¼˜é›…æœºæ¢°é’Ÿè¡¨å£°ï¼Œæ»´ç­”ä½œå“ï¼Œæé†’æ—¶é—´çš„ç¼“æ…¢æµåŠ¨', bg: '#121212', accent: '#C7B7A3', key: 'wind', imgUrl: 'images/Gemini_Generated_Image_d5q93xd5q93xd5q9.png' },
        { name: 'é“ƒé“›', desc: 'æ¸…è„†æ‚¦è€³çš„é“ƒé“›å£°ï¼Œè½»æ•²å“èµ·ï¼Œå¸¦æ¥æ¸…æ–°æ„‰æ‚¦æ„Ÿå—', bg: '#0E0E0E', accent: '#FFD166', key: 'chocolate', imgUrl: 'images/Gemini_Generated_Image_25jhe25jhe25jhe2.png' }
      ] }
    ]
    
    const asmrMap = {
      wind: ['asmr/wind1.ogg','asmr/wind2.ogg','asmr/wind3.wav','asmr/wind4.ogg'],
      birds: ['asmr/birds1.ogg','asmr/birds2.wav','asmr/birds3.wav','asmr/birds4.wav'],
      chocolate: ['asmr/chocolate1.ogg','asmr/chocolate2.ogg','asmr/chocolate3.ogg','asmr/chocolate4.ogg'],
      ear: ['asmr/ear1.wav','asmr/ear2.wav','asmr/ear3.wav','asmr/ear4.wav'],
      paper: ['asmr/paper1.ogg','asmr/paper2.ogg','asmr/paper3.ogg','asmr/paper4.ogg'],
    }
    
    /******************************
     * å…¨å±€çŠ¶æ€
     ******************************/
    let index = 0;
    let isPlaying = false;
    let textAnimating = false;
    
    const ITEM_HEIGHT = 78
    const CENTER_OFFSET = 2
    const list = document.getElementById('soundList')
    const itemEls = []
    
    let audio = new Audio()
    audio.loop = false
    audio.volume = 0.8
    let currentList = []
    let currentAudioIndex = 0
    let currentType = null
    // äº‹ä»¶ç»‘å®š
    let isDragging = false
    const curName = document.getElementById('curName')
    const curDesc = document.getElementById('curDesc')
    const playBtn = document.getElementById('playBtn')
    // èƒŒæ™¯è®¾ç½®
    const blurBg = document.getElementById('blurBg')
    const blurContainer = document.getElementById('blurContainer')
    
    /******************************
     * æ–‡æœ¬åŠ¨ç”»
     ******************************/
     let animateTimeouts = []
     let animateFrame = null
     function animateTexts(pairs) {
       animateTimeouts.forEach(t => clearTimeout(t))
       animateTimeouts = []
       if (animateFrame) cancelAnimationFrame(animateFrame)
       animateFrame = null
       pairs.forEach(({ el }) => {
         el.classList.remove('out', 'in', 'enter')
         void el.offsetHeight
         el.classList.add('out')
       })
       animateTimeouts.push(setTimeout(() => {
         pairs.forEach(({ el, text }, i) => {
           el.textContent = text
           el.classList.remove('out')
           el.classList.add('enter')
         })
         animateFrame = requestAnimationFrame(() => {
           pairs.forEach(({ el }) => {
             el.classList.remove('enter')
             el.classList.add('in')
           })
           animateTimeouts.push(setTimeout(() => {
             animateTimeouts = []
             animateFrame = null
           }, 500))
         })
       }, 300))
     }

    /******************************
     * é¡¶éƒ¨åˆ†ç±»åˆ‡æ¢
     ******************************/
    function initRecommend() {
        // 1. è·å–æ‰€æœ‰åˆ†ç±»å¡ç‰‡ï¼ˆæ³¨æ„ç±»åé€‰æ‹©å™¨è¦æœ‰ . ï¼‰
        const recommendCards = document.querySelectorAll('.recommend-card');
        const momentBackText = document.getElementById('momentBackText');
        recommendCards.forEach((card, i) => {
            card.addEventListener('click', function() {
                const wasActive = card.classList.contains('active')
                recommendCards.forEach(c => c.classList.remove('active'))
                const content = this.innerHTML;
                list.innerHTML = ''
                index = 0
                itemEls.length = 0
                momentBackText.style.opacity = 1
                    momentBackText.style.transform = 'translateX(0px)'
                if (wasActive) {
                    sounds = allList;
                    initList();
                    momentBackText.style.opacity = 0
                    momentBackText.style.transform = 'translateX(60px)'
                    momentBackText.style.transition = 'all 0.6s cubic-bezier(.4,0,.2,1)'
                    return;
                }
                card.classList.add('active');
                const categoryName = this.querySelector('.card-text').innerText;
                showMomentBackText(categoryName)
                console.log(`ç‚¹å‡»äº†ç¬¬ ${i + 1} ä¸ªåˆ†ç±»:`, categoryName);
                sounds = recommendList[i].keyvalue;
                initList();
            });
            card.style.cursor = 'pointer';
        });
    }

    function showMomentBackText(text) {
        const momentBackText = document.getElementById('momentBackText');
        momentBackText.innerHTML = ''; // æ¸…ç©º
        const chars = text.split(''); // åˆ†å‰²æˆæ¯ä¸ªå­—ç¬¦
        chars.forEach((ch, i) => {
            const span = document.createElement('span');
            span.innerText = ch;
            span.style.display = 'block';
            span.style.opacity = 0;
            span.style.transition = 'opacity 0.1s ease, transform 0.6s cubic-bezier(.4,0,.2,1)';
            span.style.transform = 'translateX(60px)'; // åˆå§‹ä½ç½®ä¸Šç§»
    
            momentBackText.appendChild(span);
    
            // å»¶è¿Ÿé€ä¸ªæ˜¾ç¤º
            setTimeout(() => {
                span.style.opacity = 1;
                span.style.transform = 'translateY(0)';
            }, i * 100); // æ¯ä¸ªå­—ç¬¦å»¶è¿Ÿ 100ms
        });
    }

    /******************************
     * åˆ—è¡¨æ¸²æŸ“ä¸çŠ¶æ€æ›´æ–°
     ******************************/
    function initList() {
      sounds.forEach((s, i) => {
        const el = document.createElement('div')
        const waves = Array.from({ length: 48 })
          .map(() => `<span style="height:${30 + Math.random()*60}%"></span>`)
          .join('')
        el.className = 'sound-item'
        el.innerHTML = `
          <div class="vinyl"></div>
          <div class="title">${String(i+1).padStart(2,'0')} ${s.name}</div>
          <div class="wave-view">${waves}</div>
        `
        el.onclick = () => {
          index = i
          update()
          if (!isPlaying) {
            isPlaying = true
            playBtn.classList.add('playing')
          }
        }
        list.appendChild(el)
        itemEls.push(el)
      })
      update()
    }
    
    function updateListState() {
      const offset = (index - CENTER_OFFSET) * ITEM_HEIGHT
      list.style.transform = `translateY(${-offset}px)`
    
      itemEls.forEach((el, i) => {
        /* console.log('sounds',sounds) */
        el.style.backgroundImage = ``
        el.classList.remove('active', 'preactive', 'nextactive')
        if (i === index) {
            el.classList.add('active')
            el.style.backgroundImage = `url(${sounds[i].imgUrl})`
            blurBg.src = sounds[i].imgUrl
            blurContainer.style.opacity = '1'
        }
        else if (i === index - 1) el.classList.add('preactive')
        else if (i === index + 1) el.classList.add('nextactive')
      })
    }
    
    /******************************
     * æ›´æ–°ç•Œé¢ä¸éŸ³æ•ˆ
     ******************************/
    function update() {
      const s = sounds[index]
      document.documentElement.style.setProperty('--bg-color', s.bg)
      document.documentElement.style.setProperty('--accent-color', s.accent)
      animateTexts([{ el: curName, text: s.name }, { el: curDesc, text: s.desc }])
      updateListState()
      if (isPlaying) {
        playAsmr(s.key)
      }
    }
    
    /******************************
     * ASMR æ’­æ”¾é€»è¾‘
     ******************************/
    function playAsmr(type) {
      if (!asmrMap[type]) return
      if (type !== currentType) {
        currentType = type
        currentList = asmrMap[type]
        currentAudioIndex = 0
      }
      playCurrent()
    }
    
    function playCurrent() {
      const src = currentList[currentAudioIndex]
      if (!src) return
      audio.src = src
      audio.currentTime = 0
      audio.play().catch(err => console.warn('æ’­æ”¾å¤±è´¥', err))
    }
    
    // æ’­æ”¾å®Œè‡ªåŠ¨åˆ‡ä¸‹ä¸€ä¸ªï¼Œæ·¡å…¥æ·¡å‡ºæ•ˆæœ
    audio.addEventListener('ended', () => {
      if (!isPlaying || isDragging) return
      fadeToNext()
    })
    
    function fadeToNext() {
      let v = audio.volume
      const fadeOut = setInterval(() => {
        v -= 0.05
        if (v <= 0) {
          clearInterval(fadeOut)
          audio.volume = 0
          currentAudioIndex = (currentAudioIndex + 1) % currentList.length
          playCurrent()
          fadeIn()
        } else {
          audio.volume = v
        }
      }, 50)
    }
    function fadeIn() {
      let v = 0
      const fadeIn = setInterval(() => {
        v += 0.05
        if (v >= 0.8) {
          audio.volume = 0.8
          clearInterval(fadeIn)
        } else {
          audio.volume = v
        }
      }, 50)
    }
    
    /******************************
     * æ’­æ”¾æŒ‰é’®
     ******************************/
    playBtn.onclick = () => {
      isPlaying = !isPlaying
      playBtn.classList.toggle('playing', isPlaying)
      if (isPlaying) playAsmr(sounds[index].key)
      else audio.pause()
    }
    /******************************
     * æ»‘åŠ¨åˆ‡æ¢éŸ³æ•ˆ
     ******************************/
    const listViewport = document.getElementById('listViewport')
    let startY = 0
    listViewport.addEventListener('touchstart', isDragging ? null : e => startY = e.touches[0].clientY)
    listViewport.addEventListener('touchend', isDragging ? null : e => {
      const dy = startY - e.changedTouches[0].clientY
      if (Math.abs(dy) > 70) {
        index = (index + (dy > 0 ? 1 : -1) + sounds.length) % sounds.length
        update()
      }
    })

    /***********************
     * å®šæ—¶å™¨é€»è¾‘
     ***********************/
    const timerContainer = document.getElementById('timerContainer')
    const timerHandle = document.getElementById('timerHandle')
    const timerProgress = document.getElementById('timerProgress')
    const timerTooltip = document.getElementById('timerTooltip')
    const timerBadge = document.getElementById('timerBadge')
    const countDownDisplay = document.getElementById('countDownDisplay')
    const timeDisplay = countDownDisplay.querySelector('.countdown-time')
    const timeSteps = [0, 3, 5, 15, 30]
    let countdownInterval = null
    let remainingSeconds = 0
    function updateTimerUI(percent, mins) {
      timerHandle.style.bottom = `${percent}%`
      timerProgress.style.height = `${percent}%`
      timerTooltip.style.bottom = `${percent}%`
      timerTooltip.innerText = mins === 0 ? "å…³é—­" : `${mins} åˆ†é’Ÿ`
      timerBadge.innerText = mins === 0 ? "å®šæ—¶å…³é—­" : `å®šæ—¶ ${mins}min`
    }
    function startCountdown(mins) {
      clearInterval(countdownInterval)
      if (mins === 0) {
        countDownDisplay.classList.remove('show')
        return
      }
      remainingSeconds = mins * 60
      countDownDisplay.classList.add('show')
      updateTimeDisplay()
      countdownInterval = setInterval(() => {
        remainingSeconds--
        if (remainingSeconds <= 0) {
          clearInterval(countdownInterval)
          isPlaying = false
          playBtn.classList.remove('playing')
          audio.pause()
          countDownDisplay.classList.remove('show')
        }
        updateTimeDisplay()
      }, 1000)
    }
    function updateTimeDisplay() {
      const m = Math.floor(remainingSeconds / 60)
      const s = remainingSeconds % 60
      timeDisplay.innerText = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`
    }
    function handleTimerMove(clientY) {
      const rect = timerContainer.getBoundingClientRect()
      let percent = ((rect.bottom - clientY) / rect.height) * 100
      percent = Math.max(0, Math.min(100, percent))
      const stepIdx = Math.round((percent / 100) * (timeSteps.length - 1))
      const snapPercent = (stepIdx / (timeSteps.length - 1)) * 100
      const mins = timeSteps[stepIdx]
      updateTimerUI(snapPercent, mins)
      return mins
    }
    const onStart = (e) => { isDragging = true; handleTimerMove(e.touches ? e.touches[0].clientY : e.clientY) }
    const onMove = (e) => { if (isDragging) handleTimerMove(e.touches ? e.touches[0].clientY : e.clientY) }
    const onEnd = (e) => {
      if (isDragging) {
        const y = e.changedTouches ? e.changedTouches[0].clientY : e.clientY
        const mins = handleTimerMove(y)
        startCountdown(mins)
        isDragging = false
      }
    }
    timerContainer.addEventListener('mousedown', onStart)
    timerTooltip.addEventListener('mousemove', onMove)
    timerTooltip.addEventListener('mouseup', onEnd)
    timerContainer.addEventListener('touchstart', onStart, {passive:false})
    timerTooltip.addEventListener('touchmove', onMove, {passive:false})
    timerTooltip.addEventListener('touchend', onEnd)
    
    /******************************
     * åˆå§‹å¯åŠ¨
     ******************************/
    initList()
    initRecommend()
    </script>
</body>
</html>
